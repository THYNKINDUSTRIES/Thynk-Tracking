<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thynk Trace - Hemp Traceability System</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="text-white py-3" style="background-color: #000000 !important;">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <img src="https://static.wixstatic.com/media/c1b522_9bfda6d971b440188dba5d8c1b0e89a6~mv2.png/v1/fill/w_229,h_87,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/c1b522_9bfda6d971b440188dba5d8c1b0e89a6~mv2.png" alt="Thynk Industries Logo" class="img-fluid" style="max-height: 60px;">
                </div>
                <div class="col-md-6 text-end">
                    <h5 class="mb-0">Thynk Trace</h5>
                    <small class="text-white-50">Hemp Traceability System</small>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="navbar navbar-dark py-2" style="background-color: #1a1a1a;">
        <div class="container-fluid">
            <div class="d-flex flex-wrap gap-2">
                <button class="btn btn-sm nav-btn" onclick="showSection('dashboard')">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </button>
                <button class="btn btn-sm nav-btn" onclick="showSection('bulkIntake')">
                    <i class="bi bi-box-arrow-in-down"></i> Bulk Intake
                </button>
                <button class="btn btn-sm nav-btn" onclick="showSection('subdivideLots')">
                    <i class="bi bi-diagram-2"></i> Subdivide Lots
                </button>
                <button class="btn btn-sm nav-btn" onclick="showSection('processConvert')">
                    <i class="bi bi-gear"></i> Process / Convert
                </button>
                <button class="btn btn-sm nav-btn" onclick="showSection('outputShip')">
                    <i class="bi bi-truck"></i> Output / Ship
                </button>
                <button class="btn btn-sm nav-btn" onclick="showSection('testing')">
                    <i class="bi bi-clipboard-check"></i> Verification
                </button>
                <button class="btn btn-sm nav-btn" onclick="showSection('inventory')">
                    <i class="bi bi-archive"></i> Inventory
                </button>
                <button class="btn btn-sm nav-btn" onclick="showSection('reports')">
                    <i class="bi bi-file-earmark-bar-graph"></i> Reports
                </button>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-3 px-4">

        <!-- ===================== DASHBOARD ===================== -->
        <div id="dashboard" class="nav-section">
            <h4 class="mb-4"><i class="bi bi-speedometer2"></i> Dashboard</h4>
            <div class="row g-3 mb-4">
                <div class="col-sm-6 col-lg-3">
                    <div class="card text-white" style="background-color: #2a2a2a;">
                        <div class="card-body text-center">
                            <i class="bi bi-boxes fs-2 text-warning"></i>
                            <h2 class="mt-2 mb-0" id="statsActiveLots">0</h2>
                            <p class="text-white-50 mb-0">Active Lots</p>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-3">
                    <div class="card text-white" style="background-color: #2a2a2a;">
                        <div class="card-body text-center">
                            <i class="bi bi-gear fs-2 text-info"></i>
                            <h2 class="mt-2 mb-0" id="statsProcesses">0</h2>
                            <p class="text-white-50 mb-0">Today's Processes</p>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-3">
                    <div class="card text-white" style="background-color: #2a2a2a;">
                        <div class="card-body text-center">
                            <i class="bi bi-truck fs-2 text-success"></i>
                            <h2 class="mt-2 mb-0" id="statsShipments">0</h2>
                            <p class="text-white-50 mb-0">Total Shipments</p>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-3">
                    <div class="card text-white" style="background-color: #2a2a2a;">
                        <div class="card-body text-center">
                            <i class="bi bi-collection fs-2" style="color: #CD7F32;"></i>
                            <h2 class="mt-2 mb-0" id="statsTotalItems">0</h2>
                            <p class="text-white-50 mb-0">Total Lots</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row g-3">
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100">
                        <div class="card-body text-center py-4" onclick="showSection('bulkIntake')" style="cursor:pointer;">
                            <i class="bi bi-box-arrow-in-down fs-1 text-warning"></i>
                            <h5 class="mt-3">Bulk Intake</h5>
                            <p class="text-muted small">Record incoming hemp materials</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100">
                        <div class="card-body text-center py-4" onclick="showSection('subdivideLots')" style="cursor:pointer;">
                            <i class="bi bi-diagram-2 fs-1 text-info"></i>
                            <h5 class="mt-3">Subdivide Lots</h5>
                            <p class="text-muted small">Break down bulk lots</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100">
                        <div class="card-body text-center py-4" onclick="showSection('processConvert')" style="cursor:pointer;">
                            <i class="bi bi-gear fs-1 text-success"></i>
                            <h5 class="mt-3">Process / Convert</h5>
                            <p class="text-muted small">Snowcapping, blending, conversion</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100">
                        <div class="card-body text-center py-4" onclick="showSection('outputShip')" style="cursor:pointer;">
                            <i class="bi bi-truck fs-1" style="color: #CD7F32;"></i>
                            <h5 class="mt-3">Output / Ship</h5>
                            <p class="text-muted small">Record outbound shipments</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== BULK INTAKE ===================== -->
        <div id="bulkIntake" class="nav-section section-hidden">
            <h4 class="mb-4"><i class="bi bi-box-arrow-in-down"></i> Bulk Intake</h4>

            <!-- Category Selection -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">1. Select Material Category</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-6 col-md-3">
                            <button class="btn w-100 py-3" onclick="selectCategory('Plant Material')">
                                <i class="bi bi-flower1 fs-3 d-block mb-1"></i>Plant Material
                            </button>
                        </div>
                        <div class="col-6 col-md-3">
                            <button class="btn w-100 py-3" onclick="selectCategory('Concentrates')">
                                <i class="bi bi-droplet-fill fs-3 d-block mb-1"></i>Concentrates
                            </button>
                        </div>
                        <div class="col-6 col-md-3">
                            <button class="btn w-100 py-3" onclick="selectCategory('Edibles')">
                                <i class="bi bi-egg-fried fs-3 d-block mb-1"></i>Edibles
                            </button>
                        </div>
                        <div class="col-6 col-md-3">
                            <button class="btn w-100 py-3" onclick="selectCategory('Topicals')">
                                <i class="bi bi-jar fs-3 d-block mb-1"></i>Topicals
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Intake Form (shown after category selection) -->
            <div id="intakeFormSection" style="display:none;">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">2. Enter Intake Details</h5>
                    </div>
                    <div class="card-body">
                        <form id="intakeForm">
                            <input type="hidden" id="intakeCategory">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">Lot ID <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="intakeLotId" placeholder="e.g. LOT-2024-001" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Date <span class="text-danger">*</span></label>
                                    <input type="date" class="form-control" id="intakeDate" required>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Quantity <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="intakeQuantity" step="0.01" min="0" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Unit <span class="text-danger">*</span></label>
                                    <select class="form-select" id="intakeUnit" required>
                                        <option value="lbs">lbs</option>
                                        <option value="kg">kg</option>
                                        <option value="g">g</option>
                                        <option value="units">units</option>
                                        <option value="oz">oz</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Vendor / Source <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="intakeVendor" placeholder="Vendor name" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Product Type</label>
                                    <input type="text" class="form-control" id="intakeProductType" placeholder="e.g. Flower, Biomass">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Cannabinoid Profile</label>
                                    <input type="text" class="form-control" id="intakeCannabinoidProfile" placeholder="e.g. THC 10%, CBD 5%">
                                </div>
                            </div>

                            <!-- Master Ledger Fields -->
                            <hr class="my-3">
                            <h6 class="text-muted">Master Ledger Fields (optional)</h6>
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">Invoice #</label>
                                    <input type="text" class="form-control" id="intakeInvoiceNum" placeholder="Invoice number">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Invoice Date</label>
                                    <input type="date" class="form-control" id="intakeInvoiceDate">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Customer Name</label>
                                    <input type="text" class="form-control" id="intakeCustomerName">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Monday Item ID</label>
                                    <input type="text" class="form-control" id="intakeMondayItemId">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Monday Link</label>
                                    <input type="url" class="form-control" id="intakeMondayLink" placeholder="https://...">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Product SKU</label>
                                    <input type="text" class="form-control" id="intakeProductSKU">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Lot Identifier</label>
                                    <input type="text" class="form-control" id="intakeLotIdentifier">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">COA Link</label>
                                    <input type="url" class="form-control" id="intakeCOALink" placeholder="https://...">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">COA Match Verified</label>
                                    <select class="form-select" id="intakeCOAMatchVerified">
                                        <option value="">-- Select --</option>
                                        <option value="Y">Yes</option>
                                        <option value="N">No</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Notes</label>
                                    <textarea class="form-control" id="intakeNotes" rows="2" placeholder="Additional notes..."></textarea>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button type="submit" class="btn btn-success">
                                    <i class="bi bi-check-lg"></i> Record Intake
                                </button>
                                <button type="button" class="btn btn-secondary ms-2" onclick="document.getElementById('intakeFormSection').style.display='none'">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Intake History Table -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Recent Intake Records</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Lot ID</th>
                                    <th>Category</th>
                                    <th>Quantity</th>
                                    <th>Date</th>
                                    <th>Vendor</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="intakeTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== SUBDIVIDE LOTS ===================== -->
        <div id="subdivideLots" class="nav-section section-hidden">
            <h4 class="mb-4"><i class="bi bi-diagram-2"></i> Subdivide Lots</h4>

            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Select Parent Lot</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3 align-items-end">
                        <div class="col-md-6">
                            <label class="form-label">Parent Lot</label>
                            <select class="form-select" id="subdivideParentLot" onchange="showSubdivideForm()">
                                <option value="">-- Select a lot to subdivide --</option>
                            </select>
                        </div>
                    </div>
                    <div id="parentLotInfo" class="mt-3" style="display:none;"></div>
                </div>
            </div>

            <div id="subdivideFormSection" style="display:none;">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Define Child Lots</h5>
                    </div>
                    <div class="card-body">
                        <div id="childLotsContainer">
                            <div class="child-lot-form mb-3 p-3 border rounded">
                                <h6>Child Lot #1</h6>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label">Child Lot ID</label>
                                        <input type="text" class="form-control child-lot-id" required>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Quantity</label>
                                        <input type="number" step="0.01" class="form-control child-lot-quantity" required onchange="updateRemainingQuantity()">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Unit</label>
                                        <input type="text" class="form-control child-lot-unit" readonly>
                                    </div>
                                    <div class="col-md-2 d-flex align-items-end">
                                        <button type="button" class="btn btn-danger" onclick="removeChildLot(this)">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-info d-flex align-items-center gap-2 mt-3">
                            <i class="bi bi-info-circle"></i>
                            Remaining: <strong><span id="remainingQuantity">0.00</span> <span id="remainingUnit"></span></strong>
                        </div>
                        <div class="d-flex gap-2 mt-3">
                            <button type="button" class="btn" onclick="addChildLot()">
                                <i class="bi bi-plus-lg"></i> Add Child Lot
                            </button>
                            <button type="button" class="btn btn-success" onclick="submitSubdivide()">
                                <i class="bi bi-check-lg"></i> Complete Subdivision
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Subdivide History -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Subdivision History</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Parent Lot</th>
                                    <th>Child Lots</th>
                                    <th>Date</th>
                                    <th>Total Quantity</th>
                                </tr>
                            </thead>
                            <tbody id="subdivideTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== PROCESS / CONVERT ===================== -->
        <div id="processConvert" class="nav-section section-hidden">
            <h4 class="mb-4"><i class="bi bi-gear"></i> Process / Convert</h4>

            <!-- Process Type Selection -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Select Process Type</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <button class="btn w-100 py-3" onclick="selectProcess('snowcapping')">
                                <i class="bi bi-snow fs-3 d-block mb-1"></i>Snowcapping
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button class="btn w-100 py-3" onclick="selectProcess('blending')">
                                <i class="bi bi-shuffle fs-3 d-block mb-1"></i>Blend Extracts
                            </button>
                        </div>
                        <div class="col-md-4">
                            <button class="btn w-100 py-3" onclick="selectProcess('conversion')">
                                <i class="bi bi-arrow-left-right fs-3 d-block mb-1"></i>Product Conversion
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Snowcapping Form -->
            <div id="snowcappingForm" style="display:none;">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-snow"></i> Snowcapping</h5>
                    </div>
                    <div class="card-body">
                        <form id="snowcappingFormElement">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">Flower Lot <span class="text-danger">*</span></label>
                                    <select class="form-select" id="snowcapFlowerLot" required>
                                        <option value="">-- Select flower lot --</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Flower Qty <span class="text-danger">*</span></label>
                                    <input type="number" step="0.01" class="form-control" id="snowcapFlowerQty" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Isolate Lot <span class="text-danger">*</span></label>
                                    <select class="form-select" id="snowcapIsolateLot" required>
                                        <option value="">-- Select isolate lot --</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Isolate Qty <span class="text-danger">*</span></label>
                                    <input type="number" step="0.01" class="form-control" id="snowcapIsolateQty" required>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Output Lot ID <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="snowcapOutputLot" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="snowcapDate">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Notes</label>
                                    <textarea class="form-control" id="snowcapNotes" rows="2"></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success mt-3">
                                <i class="bi bi-check-lg"></i> Complete Snowcapping
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Blending Form -->
            <div id="blendingForm" style="display:none;">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-shuffle"></i> Blend Extracts</h5>
                    </div>
                    <div class="card-body">
                        <form id="blendingFormElement">
                            <h6 class="mb-3">Source Extracts</h6>
                            <div id="blendSourcesContainer">
                                <div class="blend-source mb-2 p-3 border rounded">
                                    <div class="row g-2">
                                        <div class="col-md-6">
                                            <select class="form-select blend-source-lot" required>
                                                <option value="">-- Select extract lot --</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <input type="number" step="0.01" class="form-control blend-source-qty" placeholder="Quantity" required>
                                        </div>
                                        <div class="col-md-2">
                                            <button type="button" class="btn btn-danger w-100" onclick="removeBlendSource(this)">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-secondary mb-3" onclick="addBlendSource()">
                                <i class="bi bi-plus-lg"></i> Add Source
                            </button>
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">Output Lot ID <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="blendOutputLot" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Blend Type <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="blendType" placeholder="e.g. Full Spectrum" required>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Output Qty <span class="text-danger">*</span></label>
                                    <input type="number" step="0.01" class="form-control" id="blendOutputQty" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="blendDate">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Notes</label>
                                    <textarea class="form-control" id="blendNotes" rows="2"></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success mt-3">
                                <i class="bi bi-check-lg"></i> Complete Blending
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Conversion Form -->
            <div id="conversionForm" style="display:none;">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-arrow-left-right"></i> Product Conversion</h5>
                    </div>
                    <div class="card-body">
                        <form id="conversionFormElement">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">Source Lot <span class="text-danger">*</span></label>
                                    <select class="form-select" id="conversionSourceLot" required>
                                        <option value="">-- Select source lot --</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Source Qty <span class="text-danger">*</span></label>
                                    <input type="number" step="0.01" class="form-control" id="conversionSourceQty" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Product Type <span class="text-danger">*</span></label>
                                    <select class="form-select" id="conversionProductType" required>
                                        <option value="">-- Select type --</option>
                                        <option value="vapes">Vapes / Cartridges</option>
                                        <option value="gummies">Gummies</option>
                                        <option value="prerolls">Pre-rolls</option>
                                        <option value="flower">Weighed Bagged Flower</option>
                                        <option value="beverages">Beverages</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Output Lot ID <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="conversionOutputLot" required>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Units <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="conversionUnits" required>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Unit Size</label>
                                    <input type="text" class="form-control" id="conversionUnitSize" placeholder="e.g. 1g, 500mg">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" id="conversionDate">
                                </div>
                                <div class="col-12">
                                    <label class="form-label">Notes</label>
                                    <textarea class="form-control" id="conversionNotes" rows="2"></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success mt-3">
                                <i class="bi bi-check-lg"></i> Complete Conversion
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Process History -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Process History</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Inputs</th>
                                    <th>Output</th>
                                    <th>Date</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody id="processTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== OUTPUT / SHIP ===================== -->
        <div id="outputShip" class="nav-section section-hidden">
            <h4 class="mb-4"><i class="bi bi-truck"></i> Output / Ship</h4>

            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Record Shipment</h5>
                </div>
                <div class="card-body">
                    <form id="shipmentForm">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Lot <span class="text-danger">*</span></label>
                                <select class="form-select" id="shipmentLot" required>
                                    <option value="">-- Select lot --</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Quantity <span class="text-danger">*</span></label>
                                <input type="number" step="0.01" class="form-control" id="shipmentQty" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Recipient <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="shipmentRecipient" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Date <span class="text-danger">*</span></label>
                                <input type="date" class="form-control" id="shipmentDate" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Carrier</label>
                                <input type="text" class="form-control" id="shipmentCarrier" placeholder="e.g. UPS, FedEx">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Tracking #</label>
                                <input type="text" class="form-control" id="shipmentTracking">
                            </div>
                        </div>

                        <!-- Ship-To Details -->
                        <hr class="my-3">
                        <h6 class="text-muted">Ship-To Details</h6>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Ship-To Name</label>
                                <input type="text" class="form-control" id="shipmentShipToName">
                            </div>
                            <div class="col-md-5">
                                <label class="form-label">Ship-To Address</label>
                                <input type="text" class="form-control" id="shipmentShipToAddress">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">City</label>
                                <input type="text" class="form-control" id="shipmentShipToCity">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">State</label>
                                <input type="text" class="form-control" id="shipmentShipToState" maxlength="2">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">ZIP</label>
                                <input type="text" class="form-control" id="shipmentShipToZIP">
                            </div>
                        </div>

                        <!-- Financial & Compliance Details -->
                        <hr class="my-3">
                        <h6 class="text-muted">Financial &amp; Compliance Details</h6>
                        <div class="row g-3">
                            <div class="col-md-3">
                                <label class="form-label">UPS WebGate ID</label>
                                <input type="text" class="form-control" id="shipmentUPSWebGateId">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Routing</label>
                                <select class="form-select" id="shipmentRouting">
                                    <option value="">-- Select --</option>
                                    <option value="Standard">Standard</option>
                                    <option value="Depot">Depot</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Price / UOM</label>
                                <input type="number" step="0.01" class="form-control" id="shipmentPricePerUOM">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Extended Total</label>
                                <input type="number" step="0.01" class="form-control" id="shipmentExtendedTotal">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Payment Status</label>
                                <select class="form-select" id="shipmentPaymentStatus">
                                    <option value="">-- Select --</option>
                                    <option value="Paid">Paid</option>
                                    <option value="Pending">Pending</option>
                                    <option value="Overdue">Overdue</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Packet Complete</label>
                                <select class="form-select" id="shipmentPacketComplete">
                                    <option value="">-- Select --</option>
                                    <option value="Y">Yes</option>
                                    <option value="N">No</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Carrier Letter</label>
                                <select class="form-select" id="shipmentCarrierLetter">
                                    <option value="">-- Select --</option>
                                    <option value="Y">Yes</option>
                                    <option value="N">No</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">License Copy</label>
                                <select class="form-select" id="shipmentLicenseCopy">
                                    <option value="">-- Select --</option>
                                    <option value="Y">Yes</option>
                                    <option value="N">No</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Count Verified</label>
                                <select class="form-select" id="shipmentCountVerified">
                                    <option value="">-- Select --</option>
                                    <option value="Y">Yes</option>
                                    <option value="N">No</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Final Sign-Off</label>
                                <input type="text" class="form-control" id="shipmentFinalSignOff">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Archive Folder Link</label>
                                <input type="url" class="form-control" id="shipmentArchiveLink" placeholder="https://...">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Notes</label>
                                <textarea class="form-control" id="shipmentNotes" rows="2"></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success mt-3">
                            <i class="bi bi-truck"></i> Record Shipment
                        </button>
                    </form>
                </div>
            </div>

            <!-- Shipment History -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Shipment History</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Lot ID</th>
                                    <th>Quantity</th>
                                    <th>Recipient</th>
                                    <th>Date</th>
                                    <th>Tracking</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="shipmentTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== TESTING / VERIFICATION ===================== -->
        <div id="testing" class="nav-section section-hidden">
            <h4 class="mb-4"><i class="bi bi-clipboard-check"></i> Verification &amp; State Check</h4>

            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Record Verification</h5>
                </div>
                <div class="card-body">
                    <form id="testingForm">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Lot <span class="text-danger">*</span></label>
                                <select class="form-select" id="testingLot" required>
                                    <option value="">-- Select lot --</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">State Check Result <span class="text-danger">*</span></label>
                                <select class="form-select" id="testingStateCheck" required>
                                    <option value="">-- Select --</option>
                                    <option value="PASS">PASS</option>
                                    <option value="FAIL">FAIL</option>
                                    <option value="CONFIRM">CONFIRM</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Checked By <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="testingCheckedBy" required>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Checked Date</label>
                                <input type="date" class="form-control" id="testingCheckedDate">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Thynk Brain™ Consulted</label>
                                <select class="form-select" id="testingThynkBrainConsulted">
                                    <option value="">-- Select --</option>
                                    <option value="Y">Yes</option>
                                    <option value="N">No</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Thynk Brain™ Reference / Notes</label>
                                <textarea class="form-control" id="testingThynkBrainNotes" rows="2"></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-success mt-3">
                            <i class="bi bi-check-lg"></i> Record Verification
                        </button>
                    </form>
                </div>
            </div>

            <!-- Verification History -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Verification History</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Lot ID</th>
                                    <th>State Check</th>
                                    <th>Checked By</th>
                                    <th>Checked Date</th>
                                    <th>Thynk Brain™</th>
                                </tr>
                            </thead>
                            <tbody id="testingTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== INVENTORY ===================== -->
        <div id="inventory" class="nav-section section-hidden">
            <h4 class="mb-4"><i class="bi bi-archive"></i> Inventory</h4>
            <div class="mb-3">
                <div class="btn-group" role="group">
                    <button class="btn btn-sm active" onclick="filterInventory('all')">All</button>
                    <button class="btn btn-sm" onclick="filterInventory('Plant Material')">Plant Material</button>
                    <button class="btn btn-sm" onclick="filterInventory('Concentrates')">Concentrates</button>
                    <button class="btn btn-sm" onclick="filterInventory('Edibles')">Edibles</button>
                    <button class="btn btn-sm" onclick="filterInventory('Topicals')">Topicals</button>
                </div>
            </div>
            <div class="card">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Lot ID</th>
                                    <th>Category</th>
                                    <th>Current Qty</th>
                                    <th>Original Qty</th>
                                    <th>Status</th>
                                    <th>Last Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===================== REPORTS ===================== -->
        <div id="reports" class="nav-section section-hidden">
            <h4 class="mb-4"><i class="bi bi-file-earmark-bar-graph"></i> Reports &amp; Export</h4>

            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-filetype-json fs-2 mb-2 d-block text-warning"></i>
                            <h6>Export All Data</h6>
                            <p class="text-muted small">Download complete JSON export</p>
                            <button class="btn btn-sm w-100" onclick="exportAllData()">
                                <i class="bi bi-download"></i> Export JSON
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-filetype-csv fs-2 mb-2 d-block text-success"></i>
                            <h6>Master Ledger CSV</h6>
                            <p class="text-muted small">Export master ledger as CSV</p>
                            <button class="btn btn-sm w-100" onclick="exportMasterLedgerCSV()">
                                <i class="bi bi-download"></i> Export CSV
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-upload fs-2 mb-2 d-block text-info"></i>
                            <h6>Import CSV</h6>
                            <p class="text-muted small">Import master ledger from CSV</p>
                            <label class="btn btn-sm w-100">
                                <i class="bi bi-upload"></i> Import CSV
                                <input type="file" accept=".csv" style="display:none;" onchange="importMasterLedgerCSV(event)">
                            </label>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="bi bi-file-text fs-2 mb-2 d-block" style="color:#CD7F32;"></i>
                            <h6>Summary Report</h6>
                            <p class="text-muted small">Generate text summary</p>
                            <button class="btn btn-sm w-100" onclick="generateSummaryReport()">
                                <i class="bi bi-file-text"></i> Generate
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Report Output -->
            <div id="reportOutput" style="display:none;" class="mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Summary Report</h5>
                    </div>
                    <div class="card-body">
                        <pre id="reportContent" class="text-white mb-0" style="white-space:pre-wrap;"></pre>
                    </div>
                </div>
            </div>

            <!-- Chain of Custody Viewer -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Chain of Custody Viewer</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3 align-items-end mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Select Lot</label>
                            <select class="form-select" id="custodyLotSelect" onchange="showChainOfCustody()">
                                <option value="">-- Select a lot --</option>
                            </select>
                        </div>
                    </div>
                    <div id="chainOfCustodyDisplay"></div>
                </div>
            </div>
        </div>

    </div><!-- /container -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>