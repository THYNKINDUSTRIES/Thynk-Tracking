<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hemp Traceability System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding-top: 20px;
        }
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .nav-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .section-hidden {
            display: none;
        }
        .big-button {
            padding: 30px;
            font-size: 1.3em;
            border-radius: 15px;
            margin: 10px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .big-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .big-button i {
            font-size: 2em;
            display: block;
            margin-bottom: 10px;
        }
        .category-badge {
            font-size: 0.9em;
            padding: 5px 10px;
            border-radius: 20px;
        }
        .inventory-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .wizard-step {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
        }
        .process-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s;
            cursor: pointer;
        }
        .process-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        .chain-of-custody {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-size: 0.9em;
        }
        .form-label {
            font-weight: 600;
            color: #495057;
            margin-top: 10px;
        }
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        table {
            margin-bottom: 0;
        }
        .btn-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
        }
        .btn-custom:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                <i class="bi bi-check2-square"></i> Hemp Traceability System
            </a>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Main Dashboard -->
        <div id="dashboard" class="nav-section">
            <h2 class="mb-4">
                <i class="bi bi-house-door"></i> Dashboard
            </h2>
            <p class="lead">Welcome to your hemp traceability system. Choose an action below to get started.</p>
            
            <div class="row text-center">
                <div class="col-md-4 col-lg-2">
                    <button class="btn btn-primary big-button w-100" onclick="showSection('bulkIntake')">
                        <i class="bi bi-box-arrow-in-down"></i>
                        Bulk Intake
                    </button>
                </div>
                <div class="col-md-4 col-lg-2">
                    <button class="btn btn-warning big-button w-100" onclick="showSection('subdivideLots')">
                        <i class="bi bi-scissors"></i>
                        Subdivide Lots
                    </button>
                </div>
                <div class="col-md-4 col-lg-2">
                    <button class="btn btn-success big-button w-100" onclick="showSection('processConvert')">
                        <i class="bi bi-gear"></i>
                        Process/Convert
                    </button>
                </div>
                <div class="col-md-4 col-lg-2">
                    <button class="btn btn-info big-button w-100" onclick="showSection('outputShip')">
                        <i class="bi bi-box-arrow-up"></i>
                        Output/Ship
                    </button>
                </div>
                <div class="col-md-4 col-lg-2">
                    <button class="btn btn-warning big-button w-100" onclick="showSection('testing')">
                        <i class="bi bi-clipboard-check"></i>
                        Testing/Verification
                    </button>
                </div>
                <div class="col-md-4 col-lg-2">
                    <button class="btn btn-secondary big-button w-100" onclick="showSection('inventory')">
                        <i class="bi bi-archive"></i>
                        Inventory
                    </button>
                </div>
                <div class="col-md-4 col-lg-2">
                    <button class="btn btn-dark big-button w-100" onclick="showSection('reports')">
                        <i class="bi bi-file-earmark-bar-graph"></i>
                        Reports
                    </button>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="row mt-5">
                <div class="col-md-3">
                    <div class="inventory-card">
                        <h5><i class="bi bi-box-seam"></i> Active Lots</h5>
                        <h2 id="statsActiveLots">0</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="inventory-card">
                        <h5><i class="bi bi-gear-fill"></i> Processes Today</h5>
                        <h2 id="statsProcesses">0</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="inventory-card">
                        <h5><i class="bi bi-truck"></i> Shipments</h5>
                        <h2 id="statsShipments">0</h2>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="inventory-card">
                        <h5><i class="bi bi-check-circle"></i> Total Items</h5>
                        <h2 id="statsTotalItems">0</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bulk Intake Section -->
        <div id="bulkIntake" class="nav-section section-hidden">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-box-arrow-in-down"></i> Bulk Intake</h2>
                <button class="btn btn-secondary" onclick="showSection('dashboard')">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>
            
            <div class="wizard-step">
                <h5><i class="bi bi-1-circle-fill text-primary"></i> Step 1: Select Category</h5>
                <p class="text-muted">Choose the type of material you're receiving</p>
                <div class="row">
                    <div class="col-md-3">
                        <div class="process-card text-center" onclick="selectCategory('Plant Material')">
                            <i class="bi bi-flower2 text-success" style="font-size: 2em;"></i>
                            <h6 class="mt-2">Plant Material</h6>
                            <small class="text-muted">Flower, trim, biomass</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="process-card text-center" onclick="selectCategory('Concentrates')">
                            <i class="bi bi-droplet-fill text-warning" style="font-size: 2em;"></i>
                            <h6 class="mt-2">Concentrates</h6>
                            <small class="text-muted">Extracts, isolates, distillates</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="process-card text-center" onclick="selectCategory('Edibles')">
                            <i class="bi bi-cup-straw text-info" style="font-size: 2em;"></i>
                            <h6 class="mt-2">Edibles</h6>
                            <small class="text-muted">Gummies, chocolates, baked goods</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="process-card text-center" onclick="selectCategory('Topicals')">
                            <i class="bi bi-heart-pulse-fill text-danger" style="font-size: 2em;"></i>
                            <h6 class="mt-2">Topicals</h6>
                            <small class="text-muted">Creams, balms, lotions</small>
                        </div>
                    </div>
                </div>
            </div>

            <div id="intakeFormSection" class="wizard-step" style="display: none;">
                <h5><i class="bi bi-2-circle-fill text-primary"></i> Step 2: Enter Details</h5>
                <form id="intakeForm" class="row g-3">
                    <!-- Basic Information -->
                    <div class="col-md-6">
                        <label class="form-label">Lot ID / Batch Number</label>
                        <input type="text" class="form-control" id="intakeLotId" required>
                        <small class="text-muted">Unique identifier for this lot</small>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Category</label>
                        <input type="text" class="form-control" id="intakeCategory" readonly>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Quantity</label>
                        <input type="number" step="0.01" class="form-control" id="intakeQuantity" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Unit (UOM)</label>
                        <select class="form-control" id="intakeUnit" required>
                            <option value="lbs">Pounds (lbs)</option>
                            <option value="kg">Kilograms (kg)</option>
                            <option value="g">Grams (g)</option>
                            <option value="units">Units</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Date Received</label>
                        <input type="date" class="form-control" id="intakeDate" required>
                    </div>
                    
                    <!-- Invoice & Customer Details (Collapsible) -->
                    <div class="col-12">
                        <div class="accordion" id="intakeAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#invoiceSection">
                                        <i class="bi bi-receipt me-2"></i> Invoice & Customer Details
                                    </button>
                                </h2>
                                <div id="invoiceSection" class="accordion-collapse collapse" data-bs-parent="#intakeAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Invoice #</label>
                                                <input type="text" class="form-control" id="intakeInvoiceNum">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Invoice Date</label>
                                                <input type="date" class="form-control" id="intakeInvoiceDate">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Customer Name</label>
                                                <input type="text" class="form-control" id="intakeCustomerName">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Vendor/Source</label>
                                                <input type="text" class="form-control" id="intakeVendor" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#mondaySection">
                                        <i class="bi bi-link-45deg me-2"></i> Monday.com Integration
                                    </button>
                                </h2>
                                <div id="mondaySection" class="accordion-collapse collapse" data-bs-parent="#intakeAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Monday Item ID</label>
                                                <input type="text" class="form-control" id="intakeMondayItemId">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Monday Link</label>
                                                <input type="url" class="form-control" id="intakeMondayLink" placeholder="https://...">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#productSection">
                                        <i class="bi bi-box-seam me-2"></i> Product Details
                                    </button>
                                </h2>
                                <div id="productSection" class="accordion-collapse collapse" data-bs-parent="#intakeAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Product Type</label>
                                                <input type="text" class="form-control" id="intakeProductType" placeholder="e.g., THCa Flower, CBD Isolate">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Product / SKU</label>
                                                <input type="text" class="form-control" id="intakeProductSKU">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Lot Identifier</label>
                                                <input type="text" class="form-control" id="intakeLotIdentifier">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Cannabinoid Profile</label>
                                                <input type="text" class="form-control" id="intakeCannabinoidProfile" placeholder="e.g., THC: 15%, CBD: 0.5%">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#coaSection">
                                        <i class="bi bi-file-earmark-check me-2"></i> COA & Documentation
                                    </button>
                                </h2>
                                <div id="coaSection" class="accordion-collapse collapse" data-bs-parent="#intakeAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">COA Link</label>
                                                <input type="url" class="form-control" id="intakeCOALink" placeholder="https://...">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">COA Match Verified</label>
                                                <select class="form-control" id="intakeCOAMatchVerified">
                                                    <option value="">-- Select --</option>
                                                    <option value="Y">Yes</option>
                                                    <option value="N">No</option>
                                                </select>
                                            </div>
                                            <div class="col-md-12">
                                                <label class="form-label">Notes / Exception Flag</label>
                                                <textarea class="form-control" id="intakeNotes" rows="2"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <button type="submit" class="btn btn-custom btn-lg">
                            <i class="bi bi-check-circle"></i> Record Intake
                        </button>
                    </div>
                </form>
            </div>

            <hr class="my-4">
            
            <h4>Recent Intakes</h4>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Lot ID</th>
                            <th>Category</th>
                            <th>Quantity</th>
                            <th>Date</th>
                            <th>Vendor</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="intakeTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Subdivide Lots Section -->
        <div id="subdivideLots" class="nav-section section-hidden">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-scissors"></i> Subdivide Lots</h2>
                <button class="btn btn-secondary" onclick="showSection('dashboard')">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>

            <div class="wizard-step">
                <h5><i class="bi bi-1-circle-fill text-primary"></i> Step 1: Select Parent Lot</h5>
                <p class="text-muted">Choose the lot you want to subdivide into smaller lots</p>
                <select class="form-control form-control-lg" id="subdivideParentLot" onchange="showSubdivideForm()">
                    <option value="">-- Select a lot to subdivide --</option>
                </select>
                <div id="parentLotInfo" class="mt-3" style="display: none;"></div>
            </div>

            <div id="subdivideFormSection" class="wizard-step" style="display: none;">
                <h5><i class="bi bi-2-circle-fill text-primary"></i> Step 2: Create Child Lots</h5>
                <p class="text-muted">Split the parent lot into smaller child lots</p>
                
                <div id="childLotsContainer">
                    <div class="child-lot-form mb-3 p-3 border rounded">
                        <h6>Child Lot #1</h6>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Child Lot ID</label>
                                <input type="text" class="form-control child-lot-id" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Quantity</label>
                                <input type="number" step="0.01" class="form-control child-lot-quantity" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Unit</label>
                                <input type="text" class="form-control child-lot-unit" readonly>
                            </div>
                            <div class="col-md-2 d-flex align-items-end">
                                <button type="button" class="btn btn-danger" onclick="removeChildLot(this)" disabled>
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn btn-outline-primary" onclick="addChildLot()">
                    <i class="bi bi-plus-circle"></i> Add Another Child Lot
                </button>

                <div class="alert alert-info mt-3">
                    <strong>Remaining:</strong> <span id="remainingQuantity">0</span> <span id="remainingUnit"></span>
                </div>

                <button type="button" class="btn btn-custom btn-lg mt-3" onclick="submitSubdivide()">
                    <i class="bi bi-check-circle"></i> Complete Subdivision
                </button>
            </div>

            <hr class="my-4">
            
            <h4>Recent Subdivisions</h4>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Parent Lot</th>
                            <th>Child Lots</th>
                            <th>Date</th>
                            <th>Total Subdivided</th>
                        </tr>
                    </thead>
                    <tbody id="subdivideTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Process/Convert Section -->
        <div id="processConvert" class="nav-section section-hidden">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-gear"></i> Process & Convert</h2>
                <button class="btn btn-secondary" onclick="showSection('dashboard')">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>

            <div class="wizard-step">
                <h5><i class="bi bi-1-circle-fill text-primary"></i> Step 1: Choose Process Type</h5>
                <p class="text-muted">Select the type of processing you want to perform</p>
                
                <div class="row">
                    <div class="col-md-4">
                        <div class="process-card text-center" onclick="selectProcess('snowcapping')">
                            <i class="bi bi-snow text-info" style="font-size: 2em;"></i>
                            <h6 class="mt-2">Snowcapping</h6>
                            <small class="text-muted">Apply THCa isolate to flower</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="process-card text-center" onclick="selectProcess('blending')">
                            <i class="bi bi-droplet-half text-warning" style="font-size: 2em;"></i>
                            <h6 class="mt-2">Blend Extracts</h6>
                            <small class="text-muted">Combine extracts for custom blends</small>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="process-card text-center" onclick="selectProcess('conversion')">
                            <i class="bi bi-box-seam text-success" style="font-size: 2em;"></i>
                            <h6 class="mt-2">Product Conversion</h6>
                            <small class="text-muted">Convert to vapes, gummies, etc.</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Snowcapping Form -->
            <div id="snowcappingForm" class="wizard-step" style="display: none;">
                <h5><i class="bi bi-snow text-info"></i> Snowcapping Process</h5>
                <p class="text-muted">Apply THCa isolate to bulk flower to create premium infused flower</p>
                
                <form id="snowcappingFormElement" class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Select Flower Lot</label>
                        <select class="form-control" id="snowcapFlowerLot" required>
                            <option value="">-- Select flower lot --</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Flower Quantity to Use</label>
                        <input type="number" step="0.01" class="form-control" id="snowcapFlowerQty" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Select THCa Isolate Lot</label>
                        <select class="form-control" id="snowcapIsolateLot" required>
                            <option value="">-- Select isolate lot --</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Isolate Quantity to Apply</label>
                        <input type="number" step="0.01" class="form-control" id="snowcapIsolateQty" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Output Lot ID</label>
                        <input type="text" class="form-control" id="snowcapOutputLot" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Process Date</label>
                        <input type="date" class="form-control" id="snowcapDate" required>
                    </div>
                    <div class="col-md-12">
                        <label class="form-label">Notes</label>
                        <textarea class="form-control" id="snowcapNotes" rows="2"></textarea>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-custom btn-lg">
                            <i class="bi bi-check-circle"></i> Complete Snowcapping
                        </button>
                    </div>
                </form>
            </div>

            <!-- Blending Form -->
            <div id="blendingForm" class="wizard-step" style="display: none;">
                <h5><i class="bi bi-droplet-half text-warning"></i> Blend Extracts</h5>
                <p class="text-muted">Combine multiple extracts to create custom blends or consistencies</p>
                
                <form id="blendingFormElement" class="row g-3">
                    <div class="col-12">
                        <label class="form-label">Source Extracts</label>
                        <div id="blendSourcesContainer">
                            <div class="blend-source mb-2 p-3 border rounded">
                                <div class="row g-2">
                                    <div class="col-md-6">
                                        <select class="form-control blend-source-lot" required>
                                            <option value="">-- Select extract lot --</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <input type="number" step="0.01" class="form-control blend-source-qty" placeholder="Quantity" required>
                                    </div>
                                    <div class="col-md-2">
                                        <button type="button" class="btn btn-danger w-100" onclick="removeBlendSource(this)" disabled>
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-outline-primary btn-sm mt-2" onclick="addBlendSource()">
                            <i class="bi bi-plus-circle"></i> Add Another Extract
                        </button>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Output Blend Lot ID</label>
                        <input type="text" class="form-control" id="blendOutputLot" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Blend Type/Name</label>
                        <input type="text" class="form-control" id="blendType" placeholder="e.g., Hybrid Blend, High CBD Mix" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Expected Output Quantity</label>
                        <input type="number" step="0.01" class="form-control" id="blendOutputQty" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Process Date</label>
                        <input type="date" class="form-control" id="blendDate" required>
                    </div>
                    <div class="col-md-12">
                        <label class="form-label">Notes</label>
                        <textarea class="form-control" id="blendNotes" rows="2"></textarea>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-custom btn-lg">
                            <i class="bi bi-check-circle"></i> Complete Blending
                        </button>
                    </div>
                </form>
            </div>

            <!-- Conversion Form -->
            <div id="conversionForm" class="wizard-step" style="display: none;">
                <h5><i class="bi bi-box-seam text-success"></i> Product Conversion</h5>
                <p class="text-muted">Convert bulk materials into finished products</p>
                
                <form id="conversionFormElement" class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Source Lot</label>
                        <select class="form-control" id="conversionSourceLot" required>
                            <option value="">-- Select source lot --</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Quantity to Convert</label>
                        <input type="number" step="0.01" class="form-control" id="conversionSourceQty" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Product Type</label>
                        <select class="form-control" id="conversionProductType" required>
                            <option value="">-- Select product type --</option>
                            <option value="vapes">Vapes/Cartridges</option>
                            <option value="gummies">Gummies</option>
                            <option value="prerolls">Pre-Rolls</option>
                            <option value="flower">Weighed Bagged Flower</option>
                            <option value="beverages">Beverages</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Output Lot ID</label>
                        <input type="text" class="form-control" id="conversionOutputLot" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Units Produced</label>
                        <input type="number" class="form-control" id="conversionUnits" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Unit Size</label>
                        <input type="text" class="form-control" id="conversionUnitSize" placeholder="e.g., 1g, 10mg" required>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Process Date</label>
                        <input type="date" class="form-control" id="conversionDate" required>
                    </div>
                    <div class="col-md-12">
                        <label class="form-label">Notes</label>
                        <textarea class="form-control" id="conversionNotes" rows="2"></textarea>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-custom btn-lg">
                            <i class="bi bi-check-circle"></i> Complete Conversion
                        </button>
                    </div>
                </form>
            </div>

            <hr class="my-4">
            
            <h4>Recent Processes</h4>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Process Type</th>
                            <th>Input(s)</th>
                            <th>Output</th>
                            <th>Date</th>
                            <th>Details</th>
                        </tr>
                    </thead>
                    <tbody id="processTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Output/Ship Section -->
        <div id="outputShip" class="nav-section section-hidden">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-box-arrow-up"></i> Output & Shipment</h2>
                <button class="btn btn-secondary" onclick="showSection('dashboard')">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>

            <div class="wizard-step">
                <h5><i class="bi bi-1-circle-fill text-primary"></i> Record Shipment</h5>
                <p class="text-muted">Track outgoing products and maintain chain of custody</p>
                
                <form id="shipmentForm" class="row g-3">
                    <!-- Basic Shipment Info -->
                    <div class="col-md-6">
                        <label class="form-label">Select Lot to Ship</label>
                        <select class="form-control" id="shipmentLot" required>
                            <option value="">-- Select lot --</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Quantity to Ship</label>
                        <input type="number" step="0.01" class="form-control" id="shipmentQty" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Recipient/Customer</label>
                        <input type="text" class="form-control" id="shipmentRecipient" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Ship Date</label>
                        <input type="date" class="form-control" id="shipmentDate" required>
                    </div>
                    
                    <!-- Expandable Sections -->
                    <div class="col-12">
                        <div class="accordion" id="shipmentAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#shipToSection">
                                        <i class="bi bi-geo-alt me-2"></i> Ship-To Address
                                    </button>
                                </h2>
                                <div id="shipToSection" class="accordion-collapse collapse" data-bs-parent="#shipmentAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Ship-To Name</label>
                                                <input type="text" class="form-control" id="shipmentShipToName">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Ship-To Address</label>
                                                <input type="text" class="form-control" id="shipmentShipToAddress">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Ship-To City</label>
                                                <input type="text" class="form-control" id="shipmentShipToCity">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Ship-To State</label>
                                                <input type="text" class="form-control" id="shipmentShipToState" maxlength="2" placeholder="e.g., CA">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Ship-To ZIP</label>
                                                <input type="text" class="form-control" id="shipmentShipToZIP">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#trackingSection">
                                        <i class="bi bi-truck me-2"></i> Shipping & Tracking Details
                                    </button>
                                </h2>
                                <div id="trackingSection" class="accordion-collapse collapse" data-bs-parent="#shipmentAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Carrier</label>
                                                <input type="text" class="form-control" id="shipmentCarrier" placeholder="e.g., UPS, FedEx">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Tracking #</label>
                                                <input type="text" class="form-control" id="shipmentTracking">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">UPS WebGate Shipment ID</label>
                                                <input type="text" class="form-control" id="shipmentUPSWebGateId">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Routing</label>
                                                <select class="form-control" id="shipmentRouting">
                                                    <option value="">-- Select --</option>
                                                    <option value="Standard">Standard</option>
                                                    <option value="Depot">Depot</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#invoiceShipSection">
                                        <i class="bi bi-receipt me-2"></i> Invoice & Payment
                                    </button>
                                </h2>
                                <div id="invoiceShipSection" class="accordion-collapse collapse" data-bs-parent="#shipmentAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <label class="form-label">Price / UOM</label>
                                                <input type="number" step="0.01" class="form-control" id="shipmentPricePerUOM" placeholder="0.00">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Extended Total</label>
                                                <input type="number" step="0.01" class="form-control" id="shipmentExtendedTotal" placeholder="0.00">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Payment Status</label>
                                                <select class="form-control" id="shipmentPaymentStatus">
                                                    <option value="">-- Select --</option>
                                                    <option value="Pending">Pending</option>
                                                    <option value="Paid">Paid</option>
                                                    <option value="Partial">Partial</option>
                                                    <option value="Overdue">Overdue</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#packetSection">
                                        <i class="bi bi-file-earmark-check me-2"></i> Packet & Documentation
                                    </button>
                                </h2>
                                <div id="packetSection" class="accordion-collapse collapse" data-bs-parent="#shipmentAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Packet Complete</label>
                                                <select class="form-control" id="shipmentPacketComplete">
                                                    <option value="">-- Select --</option>
                                                    <option value="Y">Yes</option>
                                                    <option value="N">No</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Carrier Attention Letter Included</label>
                                                <select class="form-control" id="shipmentCarrierLetter">
                                                    <option value="">-- Select --</option>
                                                    <option value="Y">Yes</option>
                                                    <option value="N">No</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">License Copy Included</label>
                                                <select class="form-control" id="shipmentLicenseCopy">
                                                    <option value="">-- Select --</option>
                                                    <option value="Y">Yes</option>
                                                    <option value="N">No</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Count Verified</label>
                                                <select class="form-control" id="shipmentCountVerified">
                                                    <option value="">-- Select --</option>
                                                    <option value="Y">Yes</option>
                                                    <option value="N">No</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Final Sign-Off</label>
                                                <input type="text" class="form-control" id="shipmentFinalSignOff" placeholder="Initials or name">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Archive Folder Link</label>
                                                <input type="url" class="form-control" id="shipmentArchiveLink" placeholder="https://...">
                                            </div>
                                            <div class="col-md-12">
                                                <label class="form-label">Notes / Exception Flag</label>
                                                <textarea class="form-control" id="shipmentNotes" rows="2"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <button type="submit" class="btn btn-custom btn-lg">
                            <i class="bi bi-check-circle"></i> Record Shipment
                        </button>
                    </div>
                </form>
            </div>

            <hr class="my-4">
            
            <h4>Recent Shipments</h4>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Lot ID</th>
                            <th>Quantity</th>
                            <th>Recipient</th>
                            <th>Date</th>
                            <th>Tracking</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="shipmentTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Testing/Verification Section -->
        <div id="testing" class="nav-section section-hidden">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-clipboard-check"></i> Testing & Verification</h2>
                <button class="btn btn-secondary" onclick="showSection('dashboard')">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>

            <div class="wizard-step">
                <h5><i class="bi bi-1-circle-fill text-primary"></i> Record Lab Testing & State Compliance</h5>
                <p class="text-muted">Document lab results, state checks, and compliance verification</p>
                
                <form id="testingForm" class="row g-3">
                    <div class="col-md-12">
                        <label class="form-label">Select Lot to Verify</label>
                        <select class="form-control" id="testingLot" required>
                            <option value="">-- Select lot --</option>
                        </select>
                    </div>
                    
                    <!-- State Compliance Check -->
                    <div class="col-12">
                        <div class="accordion" id="testingAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#stateCheckSection">
                                        <i class="bi bi-shield-check me-2"></i> State Compliance Check
                                    </button>
                                </h2>
                                <div id="stateCheckSection" class="accordion-collapse collapse show" data-bs-parent="#testingAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-4">
                                                <label class="form-label">State Check</label>
                                                <select class="form-control" id="testingStateCheck">
                                                    <option value="">-- Select --</option>
                                                    <option value="PASS">PASS</option>
                                                    <option value="FAIL">FAIL</option>
                                                    <option value="CONFIRM">CONFIRM</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Checked By</label>
                                                <input type="text" class="form-control" id="testingCheckedBy">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Checked Date</label>
                                                <input type="date" class="form-control" id="testingCheckedDate">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#thynkBrainSection">
                                        <i class="bi bi-cpu me-2"></i> Thynk Brain Consultation
                                    </button>
                                </h2>
                                <div id="thynkBrainSection" class="accordion-collapse collapse" data-bs-parent="#testingAccordion">
                                    <div class="accordion-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label class="form-label">Thynk Brain Consulted</label>
                                                <select class="form-control" id="testingThynkBrainConsulted">
                                                    <option value="">-- Select --</option>
                                                    <option value="Y">Yes</option>
                                                    <option value="N">No</option>
                                                </select>
                                            </div>
                                            <div class="col-md-12">
                                                <label class="form-label">Thynk Brain Reference / Notes</label>
                                                <textarea class="form-control" id="testingThynkBrainNotes" rows="3"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12 mt-3">
                        <button type="submit" class="btn btn-custom btn-lg">
                            <i class="bi bi-check-circle"></i> Record Verification
                        </button>
                    </div>
                </form>
            </div>

            <hr class="my-4">
            
            <h4>Recent Verifications</h4>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Lot ID</th>
                            <th>State Check</th>
                            <th>Checked By</th>
                            <th>Checked Date</th>
                            <th>Thynk Brain</th>
                        </tr>
                    </thead>
                    <tbody id="testingTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Inventory Section -->
        <div id="inventory" class="nav-section section-hidden">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-archive"></i> Inventory View</h2>
                <button class="btn btn-secondary" onclick="showSection('dashboard')">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>

            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="btn-group" role="group">
                        <button class="btn btn-outline-primary active" onclick="filterInventory('all')">All Items</button>
                        <button class="btn btn-outline-primary" onclick="filterInventory('Plant Material')">Plant Material</button>
                        <button class="btn btn-outline-primary" onclick="filterInventory('Concentrates')">Concentrates</button>
                        <button class="btn btn-outline-primary" onclick="filterInventory('Edibles')">Edibles</button>
                        <button class="btn btn-outline-primary" onclick="filterInventory('Topicals')">Topicals</button>
                    </div>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Lot ID</th>
                            <th>Category</th>
                            <th>Current Quantity</th>
                            <th>Original Quantity</th>
                            <th>Status</th>
                            <th>Last Updated</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTable"></tbody>
                </table>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reports" class="nav-section section-hidden">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="bi bi-file-earmark-bar-graph"></i> Reports & Export</h2>
                <button class="btn btn-secondary" onclick="showSection('dashboard')">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </button>
            </div>

            <div class="row">
                <div class="col-md-4">
                    <div class="wizard-step">
                        <h5><i class="bi bi-file-earmark-spreadsheet"></i> Export Master Ledger CSV</h5>
                        <p class="text-muted">Export data in master ledger CSV format</p>
                        <button class="btn btn-custom btn-lg w-100" onclick="exportMasterLedgerCSV()">
                            <i class="bi bi-file-earmark-spreadsheet"></i> Export CSV
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="wizard-step">
                        <h5><i class="bi bi-download"></i> Export JSON</h5>
                        <p class="text-muted">Export all data as JSON for backup</p>
                        <button class="btn btn-custom btn-lg w-100" onclick="exportAllData()">
                            <i class="bi bi-file-earmark-code"></i> Export JSON
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="wizard-step">
                        <h5><i class="bi bi-upload"></i> Import CSV Data</h5>
                        <p class="text-muted">Import master ledger CSV file</p>
                        <input type="file" id="csvImportFile" accept=".csv" style="display: none;" onchange="importMasterLedgerCSV(event)">
                        <button class="btn btn-success btn-lg w-100" onclick="document.getElementById('csvImportFile').click()">
                            <i class="bi bi-upload"></i> Import CSV
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-md-12">
                    <div class="wizard-step">
                        <h5><i class="bi bi-bar-chart"></i> Summary Report</h5>
                        <p class="text-muted">View comprehensive system summary</p>
                        <button class="btn btn-custom btn-lg w-100" onclick="generateSummaryReport()">
                            <i class="bi bi-clipboard-data"></i> Generate Summary
                        </button>
                    </div>
                </div>
            </div>

            <div id="reportOutput" class="wizard-step mt-4" style="display: none;">
                <h5>Report Output</h5>
                <pre id="reportContent" style="background: #f8f9fa; padding: 20px; border-radius: 10px; max-height: 500px; overflow-y: auto;"></pre>
            </div>

            <hr class="my-4">

            <h4>Chain of Custody</h4>
            <div class="mb-3">
                <label class="form-label">Select Lot ID to View Chain of Custody</label>
                <select class="form-control" id="custodyLotSelect" onchange="showChainOfCustody()">
                    <option value="">-- Select a lot --</option>
                </select>
            </div>
            <div id="chainOfCustodyDisplay"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
